<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCrtlMuj3mZnI5NGVkgw5ME1hZL-XEtRzI&callback=initMap">
    
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCrtlMuj3mZnI5NGVkgw5ME1hZL-XEtRzI&libraries=places"></script>

<body>
    <div id="map" style="width: 100%; height: 400px;"></div>
    <div id="hungryvery">
        <input name="location" id="location" placeholder="Where are you?">

        </input>
        <button onclick="geteateriesnearby()">Hungry?</button>
    </div>
    <div id="isopen">
        <input name="time" id="time" placeholder="What time is it?">
        </input>
        <button onclick="checkOpenStatus()">Is it open?</button>
    </div>
</body>

    <script>
    

      function initMap() {

    var pointA = new google.maps.LatLng(51.7519, -1.2578);
    var pointB = new google.maps.LatLng(50.8429, -0.1313);
    myOptions = {
      zoom: 7,
      center: pointA
    },
    map = new google.maps.Map(document.getElementById('map'), myOptions),
    // Instantiate a directions service.
    directionsService = new google.maps.DirectionsService,
    directionsDisplay = new google.maps.DirectionsRenderer({
      map: map
    }),
    markerA = new google.maps.Marker({
      position: pointA,
      title: "point A",
      label: "A",
      map: map
    }),
    markerB = new google.maps.Marker({
      position: pointB,
      title: "point B",
      label: "B",
      map: map
    });

  // get route from A to B
  calculateAndDisplayRoute(directionsService, directionsDisplay, pointA, pointB);

}



function calculateAndDisplayRoute(directionsService, directionsDisplay, pointA, pointB) {
  directionsService.route({
    origin: pointA,
    destination: pointB,
    travelMode: google.maps.TravelMode.DRIVING
  }, function(response, status) {
    if (status == google.maps.DirectionsStatus.OK) {
      directionsDisplay.setDirections(response);
      console.log(response);
    } else {
      window.alert('Directions request failed due to ' + status);
    }
  });
}

function geteateriesnearby(){
    var geocoder = new google.maps.Geocoder();
    var postalCode = document.getElementById('location').value;
    geocoder.geocode({ address: postalCode }, function (results, status) {
    if (status === google.maps.GeocoderStatus.OK) {
      var location = results[0].geometry.location;
      var request = {
        location: location,
        radius: '500',
        type: ['restaurant'],
        componentRestrictions: { country: "sg" }
      };

      service = new google.maps.places.PlacesService(map);
      service.nearbySearch(request, callback);
    } else {
      console.error('Geocode was not successful for the following reason: ' + status);
    }
  });

  function callback(results, status) {
    if (status == google.maps.places.PlacesServiceStatus.OK) {
      for (var i = 0; i < results.length; i++) {
        var place = results[i];
        console.log(place);
        checkOpenStatus(place.place_id, '12:00 PM'); // Change the time as needed
      }
    }
  }
}
function checkOpenStatus() {
  let checkTime = document.getElementById('time').value;
  var placeId = "ChIJIyHR_58Z2jERGs8ou1UQWKg"; // Replace with your place ID
  var request = {
    placeId: placeId,
    fields: ['name', 'opening_hours'],
  };

  var service = new google.maps.places.PlacesService(map); // Assuming 'map' is accessible

  service.getDetails(request, function (place, status) {
    if (status === google.maps.places.PlacesServiceStatus.OK) {
      var isOpenNow = false;

      if (place.opening_hours) {
        // Convert checkTime to a Date object for the specific date you want to check
        var checkDate = new Date('2023-10-16 ' + checkTime);

        var openingHours = place.opening_hours;
        console.log(openingHours);
        openingHours.periods.forEach(function (period) {
          var openTime = new Date('2023-10-16 ' + period.open.time);
          var closeTime = new Date('2023-10-16 ' + period.close.time);

          if (checkDate >= openTime && checkDate <= closeTime) {
            isOpenNow = true;
          }
        });
      }

      console.log(
        place.name + ' is open at ' + checkTime + ': ' + (isOpenNow ? 'Yes' : 'No')
      );
    } else {
      console.error(`Error: ${status}`);
    }
  });
}

      
</script>
</html>